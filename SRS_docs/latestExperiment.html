<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Edamam API Query to Chart.JS Testing</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="Chart.bundle.min.js"></script>
</head>

<body>
  <div class="container">
    <h1>Edamam API Query to Chart.JS Testing</h1>

    <!-- We'll be dumping our JSON contents in here -->
    <div id="foodDiv"></div>

    <!-- This form will be where users input data about the movies -->
    <form id="searchForm">
      <label for="ingr-input">search</label>
      <input type="text" id="ingr-input"><br>

      <!-- This button will trigger our AJAX call -->
      <input id="findIngr" type="submit" value="ingredient search">
    </form>

    <div id="thisHere"></div>

    <canvas id="nutrChart" width="90%" height="30%">
    </canvas>

    <!-- <div id="dynamicChart"></div> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
      // This .on("click") function will trigger the AJAX Call
      $("#findIngr").on("click", function(event) {

        // event.preventDefault() can be used to prevent an event's default behavior.
        // Here, it prevents the submit button from trying to submit a form when clicked
        event.preventDefault();

        // Here we grab the text from the input box
        var ingredient = $("#ingr-input").val().trim();
        
        var appId = "015a1dc7"

        // "36c66d3a"
        
        var appKey = "16bab94aee14b5881f28798e788c26e0"

        // "8be8dd8b6a6f98a5221770fcb1d2f043"

        // Here we construct our URL
        var queryURL = "https://api.edamam.com/search?q=" + ingredient + "&app_id=" + appId + "&app_key=" + appKey + "&from=0&to=1";

        // https://api.edamam.com/search?app_id=yourappid&app_key=yourappkey&q=butter&diet=low-carb&diet=high-protein

// =====================================================

// =====================================================

        $.ajax({
          // xhrFields: {cors: false},
          url: queryURL,
          method: "GET"
        }).done(function(response) {
          console.log(response);

          var x = (JSON.stringify(response));

          var y = response;

          localStorage.setItem('ourData', JSON.stringify(response));
        });

        var retrData = JSON.parse(localStorage.getItem('ourData'));

        var carbData = JSON.stringify(retrData.hits[0].recipe.totalDaily.CHOCDF);

        console.log(carbData);

        var proData = JSON.stringify(retrData.hits[0].recipe.totalDaily.PROCNT);

        localStorage.setItem('proDataLS', JSON.stringify(retrData.hits[0].recipe.totalDaily.PROCNT));

        var fatData = JSON.stringify(retrData.hits[0].recipe.totalDaily.FAT);

        localStorage.setItem('fatDataLS', JSON.stringify(retrData.hits[0].recipe.totalDaily.FAT));

        var satFatData = JSON.stringify(retrData.hits[0].recipe.totalDaily.FASAT);

        localStorage.setItem('fatSatDataLS', JSON.stringify(retrData.hits[0].recipe.totalDaily.FASAT));

        var fiberData = JSON.stringify(retrData.hits[0].recipe.totalDaily.FIBTG);

        localStorage.setItem('fiberDataLS', JSON.stringify(retrData.hits[0].recipe.totalDaily.FIBTG)); 

        // for each in [carbData, proData, fatData, fatSatData, fiberData] {
        //   var newDiv = $("<div>");
        //   newDiv.text()
        // }

          $("#thisHere").append ("Carbohydrates: " + carbData);

          $("#thisHere").append ("Protein: " + proData);

          $("#thisHere").append ("Total Fat: " + fatData);

          $("#thisHere").append ("Saturated Fat: " + satFatData);

          $("#thisHere").append ("Fiber: " + fiberData);

          });

            var retrCarbData = JSON.parse(localStorage.getItem('carbDataLS'));

            var retrProData = JSON.parse(localStorage.getItem('proDataLS'));

            var retrFatData = JSON.parse(localStorage.getItem('fatDataLS'));

            var retrSatFatData = JSON.parse(localStorage.getItem('satFatDataLS'));

            var retrFiberData = JSON.parse(localStorage.getItem('fiberDataLS'));


      var nutrUSDA = $("#nutrChart");

      Chart.defaults.global.defaultFontFamily = 'Times';
      Chart.defaults.global.defaultFontColor = 'grey';

      var theChart = new Chart(nutrUSDA, {
          type: 'bar',
          data: {
              labels: ["Carbs", "Protein", "Fat", "Saturated Fat", "Fiber"],
            // coded as CHOCDF, PROCNT, FAT, FASAT, FIBTG // in our Edamam JSON results

            // Carbohydrates, protein, fat, and fiber
            // are so-called 'macronutrients,'
            // fundamental characteristics of foods,
            // as noted by professional nutritionists,
            // and referenced in the pre-eminent academic
            // nutritional textbook 'Nutrition Now.'
            // They're also often referenced by the
            // National Institutes of Health, as
            // representing the most important
            // nutrient data.

              datasets: [{
                  label: 'Percentage by Nutrient',
                  data: [retrCarbData, retrProData, retrFatData, retrSatFatData, retrFiberData],
                  backgroundColor: [
                      'red',
                      'blue',
                      'yellow',
                      'purple',
                      'green',
                  ],
                  borderColor: '#777',
                  hoverBorderWidth: 4,
                  hoverBorderColor: 'cyan',
              }]
          },
          options: {
            title: {
              display: true,
              text:'USDA Recommended Daily Consumption (%)',
              fontSize: 20
              },
            legend: {
              display: false
            },
            scales: {
                  xAxes: [{
                      ticks: {
                        suggestedMin: 0,
                        suggestedMax: 40,
                        stepSize: 10
                      }
                  }],
              },
            },
          });
    </script>
  </div>
</body>

</html>